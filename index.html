<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>CS2 Case</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background-color: #1b1b1b;
            color: #fff;
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
        }
        .balance { font-size: 20px; color: #de9b35; margin-bottom: 20px; }
        .case-container { margin: 30px 0; }
        .case-img { width: 150px; transition: 0.3s; }
        
        .result-box {
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            margin-top: 20px;
            padding: 15px;
            background: #2d2d2d;
            border: 2px solid #de9b35;
            border-radius: 10px;
        }
        .skin-name { font-size: 18px; font-weight: bold; margin: 10px 0; }
        
        .btn {
            background: #de9b35;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
        }
        .btn:disabled { background: #555; cursor: not-allowed; }
    </style>
</head>
<body>

    <h1>Revolution Case</h1>
    <div class="balance">–ë–∞–ª–∞–Ω—Å: <span id="balance-display">...</span> GC</div>

    <div class="case-container">
        <img src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXU5A1PIYQNqhpOSV-fRPasw8rsUFJ5KBFZv668FFQwnfCcJm4XuY_kx9KwlKL2MOrQlzkG7ZMg2r2VrD3wjg/360fx360f" class="case-img" id="case-img">
    </div>

    <div id="result-screen" class="result-box">
        <div>üéâ –¢–≤–æ–π –≤—ã–∏–≥—Ä—ã—à:</div>
        <div class="skin-name" id="skin-name">...</div>
        <button class="btn" onclick="sendResult()">–ó–ê–ë–†–ê–¢–¨ –í –ò–ù–í–ï–ù–¢–ê–†–¨</button>
    </div>

    <button class="btn" id="open-btn" onclick="openCase()">–û–¢–ö–†–´–¢–¨ (50 GC)</button>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        // 1. –ü–æ–ª—É—á–∞–µ–º –±–∞–ª–∞–Ω—Å –∏–∑ —Å—Å—ã–ª–∫–∏
        const urlParams = new URLSearchParams(window.location.search);
        let userBalance = parseInt(urlParams.get('balance')) || 0;
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –±–∞–ª–∞–Ω—Å
        document.getElementById('balance-display').innerText = userBalance;

        // –°–ø–∏—Å–æ–∫ —Å–∫–∏–Ω–æ–≤ (–ø—Ä–æ—Å—Ç–∞—è —Ä—É–ª–µ—Ç–∫–∞)
        const skins = [
            "M4A4 | Temukau (Legendary)",
            "AK-47 | Head Shot",
            "AWP | Duality",
            "P90 | Neoqueen",
            "Glock-18 | Umbral Rabbit",
            "MAC-10 | Sakkaku",
            "USP-S | Ticket to Hell"
        ];

        let currentWonSkin = "";

        function openCase() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–Ω–µ–≥
            if (userBalance < 50) {
                tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥! –ù—É–∂–Ω–æ 50 GC.");
                return;
            }

            // –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ (—Ä–µ–∞–ª—å–Ω–æ–µ —Å–¥–µ–ª–∞–µ—Ç –±–æ—Ç)
            userBalance -= 50;
            document.getElementById('balance-display').innerText = userBalance;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è (—Ç–∏–ø–∞)
            document.getElementById('open-btn').style.display = 'none'; // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É
            document.getElementById('case-img').style.transform = "scale(1.1) rotate(5deg)";
            
            setTimeout(() => {
                // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Å–∫–∏–Ω
                const randomSkin = skins[Math.floor(Math.random() * skins.length)];
                currentWonSkin = randomSkin;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                document.getElementById('case-img').style.transform = "scale(1)";
                document.getElementById('skin-name').innerText = randomSkin;
                document.getElementById('result-screen').style.display = 'block';
                
                tg.HapticFeedback.notificationOccurred('success'); // –í–∏–±—Ä–∞—Ü–∏—è
            }, 1000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞ –¥–ª—è "–∏–Ω—Ç—Ä–∏–≥–∏"
        }

        function sendResult() {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
            // action: 'buy_case' –≥–æ–≤–æ—Ä–∏—Ç –±–æ—Ç—É, —á—Ç–æ –º—ã –∫—É–ø–∏–ª–∏ –∫–µ–π—Å
            // skin: –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ –≤—ã–ø–∞–ª–æ
            const data = JSON.stringify({
                action: 'buy_case',
                skin: currentWonSkin
            });
            
            tg.sendData(data); // –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∑–∞–∫—Ä–æ–µ—Ç –æ–∫–Ω–æ –∏ –ø–µ—Ä–µ—à–ª–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —á–∞—Ç
        }
    </script>
</body>
</html>
